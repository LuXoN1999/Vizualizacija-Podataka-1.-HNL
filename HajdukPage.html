<!DOCTYPE html>
<html>

<head>
    <title>HNK Hajduk Split</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="./teams.js"></script>
    <script src="./mainVariables.js"></script>
    <script src="./additionalFunctions.js"></script>
    <style>
        body {
            background-color: white;
        }
    </style>

</head>

<body>

</body>
<script>
    var currentTeamIndex = 0;

    var svg = d3.select("body")
        .append("svg")
        .attr("width", svgWidth)
        .attr("height", svgHeight)
        .style("border-radius", defaultBorderRadius)
        .style("background-color", "#808080")
        .style("opacity", 0.75);

    var clubImage = svg.append("image")
        .attr("x", clubEmblemX)
        .attr("y", clubEmblemY)
        .attr("width", clubEmblemWidth)
        .attr("height", clubEmblemHeight)
        .attr("xlink:href", "./Images/HNKHajdukSplit.png");

    var clubNameText = svg.append("text")
        .text(teamsData[currentTeamIndex].name)
        .attr("x", clubHeaderTextX)
        .attr("y", clubHeaderTextY)
        .style("font-size", headerTextFontSize)
        .style("font-family", defaultFontFamily);

    var WDLText = svg.append("text")
        .text("Pobjede/Neriješeno/Porazi")
        .attr("x", WDLTextX)
        .attr("y", commonTextY)
        .style("font-size", normalTextFontSize)
        .style("font-family", defaultFontFamily);

    var playersText = svg.append("text")
        .text("Igrači: " + (teamsData[currentTeamIndex].totalplayers).toString())
        .attr("x", playersTextX)
        .attr("y", commonTextY)
        .style("font-size", normalTextFontSize)
        .style("font-family", defaultFontFamily);

    var goalDifferenceText = svg.append("text")
        .text(function () {
            var difference = teamsData[currentTeamIndex].goals - teamsData[currentTeamIndex].goalsconceded;
            if (difference > 0) {
                return "Gol razlika: +" + difference;
            }
            if (difference == 0) {
                return "Gol razlika: 0";
            }
            return "Gol razlika: " + difference;

        })
        .attr("x", goalDifferenceTextX)
        .attr("y", commonTextY)
        .style("font-size", normalTextFontSize)
        .style("font-family", defaultFontFamily);

    var nationalTeamPlayersText = svg.append("text")
        .text("Reprezentativci: " + teamsData[currentTeamIndex].nationalteamplayers)
        .attr("x", playersTextX - 175)
        .attr("y", commonTextY + 50)
        .style("font-size", smallTextFontSize)
        .style("font-family", defaultFontFamily);

    var foreignPlayersText = svg.append("text")
        .text("Stranci: " + teamsData[currentTeamIndex].foreignplayers)
        .attr("x", playersTextX - 175)
        .attr("y", commonTextY + 275)
        .style("font-size", smallTextFontSize)
        .style("font-family", defaultFontFamily);


    var nationalTeamPlayersPie = d3.pie()
        .value(function (d, i) {
            if (i == 0) {
                return teamsData[currentTeamIndex].nationalteamplayers;
            }
            else if (i == 1) {
                return teamsData[currentTeamIndex].totalplayers - teamsData[currentTeamIndex].nationalteamplayers;
            }
            else {
                return 0;
            }
        });

    var nationalTeamPlayersPieArcs = svg.selectAll("g.pie")
        .data(nationalTeamPlayersPie(teamsData))
        .enter()
        .append("path")
        .attr("id", function (d, i) { return "pie0_arc" + i })
        .attr("transform", "translate(" + commonPieChartX + ", " + upperPieChartY + ")")
        .attr("d", defaultArc)
        .attr("fill", function (d, i) {
            if (i == 0) {
                return color[1];
            }
            return color[0];
        });

    var nationalTeamPlayersPercentageText = svg.append("text")
        .text(parseFloat((teamsData[currentTeamIndex].nationalteamplayers / teamsData[currentTeamIndex].totalplayers * 100)).toFixed(1) + "%")
        .attr("x", commonPieChartX + 10)
        .attr("y", upperPieChartY)
        .attr("id", "nationalTeamPercentageText")
        .style("opacity", 0)
        .style("fill", "red")
        .style("font-size", normalTextFontSize)
        .style("font-family", defaultFontFamily);

    var foreignPlayersPie = d3.pie()
        .value(function (d, i) {
            if (i == 0) {
                return teamsData[currentTeamIndex].foreignplayers;
            }
            else if (i == 1) {
                return teamsData[currentTeamIndex].totalplayers - teamsData[currentTeamIndex].foreignplayers;
            }
            else {
                return 0;
            }
        });

    var foreignPlayersPieArcs = svg.selectAll("g.pie")
        .data(foreignPlayersPie(teamsData))
        .enter()
        .append("path")
        .attr("id", function (d, i) { return "pie1_arc" + i })
        .attr("transform", "translate(" + commonPieChartX + "," + lowerPieChartY + ")")
        .attr("d", defaultArc)
        .attr("fill", function (d, i) {
            if (i == 0) {
                return color[1];
            }
            return color[0];
        });
    var foreignPlayersPercentageText = svg.append("text")
        .text(parseFloat((teamsData[currentTeamIndex].foreignplayers / teamsData[currentTeamIndex].totalplayers * 100)).toFixed(1) + "%")
        .attr("x", commonPieChartX + 10)
        .attr("y", lowerPieChartY)
        .attr("id", "foreignPlayersPercentageText")
        .style("opacity", 0)
        .style("fill", "red")
        .style("font-size", normalTextFontSize)
        .style("font-family", defaultFontFamily);

    svg.select("#pie0_arc0")
        .on("mouseover", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .attr("d", arcOnHover)
                .style("fill", "red")
                .style("opacity", 0.5);
            d3.select("#nationalTeamPercentageText")
                .transition()
                .duration(500)
                .style("opacity", 1);
        })
        .on("mouseout", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .attr("d", defaultArc)
                .style("fill", color[1])
                .style("opacity", 1);
            d3.select("#nationalTeamPercentageText")
                .transition()
                .duration(500)
                .style("opacity", 0);
        });

    svg.select("#pie1_arc0")
        .on("mouseover", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .attr("d", arcOnHover)
                .style("fill", "red")
                .style("opacity", 0.5);
            d3.select("#foreignPlayersPercentageText")
                .transition()
                .duration(500)
                .style("opacity", 1);
        })
        .on("mouseout", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .attr("d", defaultArc)
                .style("fill", color[1])
                .style("opacity", 1);
            d3.select("#foreignPlayersPercentageText")
                .transition()
                .duration(500)
                .style("opacity", 0);
        });

    clearUnnecessaryArcs();

    var xScale = d3.scaleBand()
        .range([0, barchartWidth])
        .domain(["Zabijeno", "Primljeno"])
    var yScale = d3.scaleLinear()
        .range([barchartHeight, 0])
        .domain([0, 100]);

    var goalDifferenceBarchartContainer = svg.append("g")
        .attr("transform", "translate(" + goalDifferenceBarchartX + "," + goalDifferenceBarchartY + ")");

    goalDifferenceBarchartContainer.append("g")
        .attr("transform", "translate(0," + barchartHeight + ")")
        .call(d3.axisBottom(xScale));

    goalDifferenceBarchartContainer.append("g")
        .call(d3.axisLeft(yScale).ticks(10))

    goalDifferenceBarchartContainer.selectAll("rect")
        .data(teamsData)
        .enter()
        .append("rect")
        .attr("id", function (d, i) { return "rect" + i; })
        .attr("x", 0)
        .attr("y", function (d, i) {
            if (i == 0) {
                return yScale(teamsData[currentTeamIndex].goals);
            }
            else if (i == 1) {
                return yScale(teamsData[currentTeamIndex].goalsconceded);
            }
            return 0;
        })
        .attr("width", xScale.bandwidth() / 2)
        .attr("height", function (d, i) {
            if (i == 0) {
                return barchartHeight - yScale(teamsData[currentTeamIndex].goals);
            } else if (i == 1) {
                return barchartHeight - yScale(teamsData[currentTeamIndex].goalsconceded);
            } else {
                return 0;
            }
        })
        .style("fill", function (d, i) {
            if (i == 0) {
                return "green";
            }
            else if (i == 1) {
                return "red";
            }
        })
        .style("opacity", 0)
        .transition()
        .duration(1250)
        .attr("x", function (d, i) {
            if (i == 0) {
                return xScale("Zabijeno") + barchartWidth / 4 - xScale.bandwidth() / 4;
            }
            else if (i == 1) {
                return xScale("Primljeno") + barchartWidth / 4 - xScale.bandwidth() / 4;
            }
            return 0;
        })
        .style("opacity", 0.75);

    goalDifferenceBarchartContainer.append("text")
        .text(teamsData[currentTeamIndex].goals)
        .attr("x", 0)
        .attr("y", function () {
            return barchartHeight - svg.select("#rect0").attr("height");
        })
        .style("opacity", 0)
        .style("font-size", normalTextFontSize)
        .style("font-family", defaultFontFamily)
        .transition()
        .duration(1250)
        .attr("x", xScale("Zabijeno") + barchartWidth / 4 - 15)
        .style("opacity", 1);

    goalDifferenceBarchartContainer.append("text")
        .text(teamsData[currentTeamIndex].goalsconceded)
        .attr("x", 0)
        .attr("y", function () {
            return barchartHeight - svg.select("#rect1").attr("height");
        })
        .style("opacity", 0)
        .style("font-size", normalTextFontSize)
        .style("font-family", defaultFontFamily)
        .transition()
        .duration(1500)
        .attr("x", xScale("Primljeno") + barchartWidth / 4 - 15)
        .style("opacity", 1);

    var firstBarPercentageText = goalDifferenceBarchartContainer.append("text")
        .attr("id", "goalsScoredPercentage")
        .attr("x", xScale("Zabijeno") + barchartWidth / 4 - xScale.bandwidth() / 4 + 7.5)
        .attr("y", function () {
            return barchartHeight - svg.select("#rect0").attr("height") * 0.5;
        })
        .style("font-size", normalTextFontSize)
        .style("font-family", defaultFontFamily)
        .style("opacity", 0)
        .text((teamsData[currentTeamIndex].goals / (teamsData[currentTeamIndex].goals + teamsData[currentTeamIndex].goalsconceded) * 100).toFixed(1) + "%");

    var secondBarPercentageText = goalDifferenceBarchartContainer.append("text")
        .attr("id", "goalsConcededPercentage")
        .attr("x", xScale("Primljeno") + barchartWidth / 4 - xScale.bandwidth() / 4 + 7.5)
        .attr("y", function () {
            return barchartHeight - svg.select("#rect1").attr("height") * 0.5;
        })
        .style("font-size", normalTextFontSize)
        .style("font-family", defaultFontFamily)
        .style("opacity", 0)
        .text((teamsData[currentTeamIndex].goalsconceded / (teamsData[currentTeamIndex].goals + teamsData[currentTeamIndex].goalsconceded) * 100).toFixed(1) + "%");


    goalDifferenceBarchartContainer.append("text")
        .attr("id", "overallGoalsText1")
        .attr("x", xScale("Zabijeno") + barchartWidth / 4 - xScale.bandwidth() / 4 + 5)
        .attr("y", function () {
            return barchartHeight - svg.select("#rect0").attr("height") * 0.5 + 13;
        })
        .text("od svih golova")
        .style("font-size", ultrasmallTextFontSize)
        .style("font-family", defaultFontFamily)
        .style("opacity", 0);


    goalDifferenceBarchartContainer.append("text")
        .attr("id", "overallGoalsText2")
        .attr("x", xScale("Primljeno") + barchartWidth / 4 - xScale.bandwidth() / 4 + 5)
        .attr("y", function () {
            return barchartHeight - svg.select("#rect1").attr("height") * 0.5 + 13;
        })
        .text("od svih golova")
        .style("font-size", ultrasmallTextFontSize)
        .style("font-family", defaultFontFamily)
        .style("opacity", 0);

    svg.select("#rect0")
        .on("mouseover", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .style("opacity", 1);
            d3.select("#goalsScoredPercentage")
                .transition()
                .duration(500)
                .style("opacity", 1);
            d3.select("#overallGoalsText1")
                .transition()
                .duration(500)
                .style("opacity", 1);
        })
        .on("mouseout", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .style("opacity", 0.5);
            d3.select("#goalsScoredPercentage")
                .transition()
                .duration(500)
                .style("opacity", 0);
            d3.select("#overallGoalsText1")
                .transition()
                .duration(500)
                .style("opacity", 0);
        });

    svg.select("#rect1")
        .on("mouseover", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .style("opacity", 1);
            d3.select("#goalsConcededPercentage")
                .transition()
                .duration(500)
                .style("opacity", 1);
            d3.select("#overallGoalsText2")
                .transition()
                .duration(500)
                .style("opacity", 1);
        })
        .on("mouseout", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .style("opacity", 0.5);
            d3.select("#goalsConcededPercentage")
                .transition()
                .duration(500)
                .style("opacity", 0);
            d3.select("#overallGoalsText2")
                .transition()
                .duration(500)
                .style("opacity", 0);
        });

    svg.select("#goalsScoredPercentage")
        .on("mouseover", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .style("opacity", 1);
            d3.select("#overallGoalsText1")
                .transition()
                .duration(500)
                .style("opacity", 1);
            d3.select("#rect0")
                .transition()
                .duration(500)
                .style("opacity", 1);
        })
        .on("mouseout", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .style("opacity", 0);
            d3.select("#overallGoalsText1")
                .transition()
                .duration(500)
                .style("opacity", 0);
            d3.select("#rect0")
                .transition()
                .duration(500)
                .style("opacity", 0.75);
        });

    svg.select("#goalsConcededPercentage")
        .on("mouseover", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .style("opacity", 1);
            d3.select("#overallGoalsText2")
                .transition()
                .duration(500)
                .style("opacity", 1);
            d3.select("#rect1")
                .transition()
                .duration(500)
                .style("opacity", 1);
        })
        .on("mouseout", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .style("opacity", 0);
            d3.select("#overallGoalsText2")
                .transition()
                .duration(500)
                .style("opacity", 0);
            d3.select("#rect1")
                .transition()
                .duration(500)
                .style("opacity", 0.75);
        });

    svg.select("#overallGoalsText1")
        .on("mouseover", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .style("opacity", 1);
            d3.select("#goalsScoredPercentage")
                .transition()
                .duration(500)
                .style("opacity", 1);
            d3.select("#rect0")
                .transition()
                .duration(500)
                .style("opacity", 1);
        })
        .on("mouseout", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .style("opacity", 0);
            d3.select("#goalsScoredPercentage")
                .transition()
                .duration(500)
                .style("opacity", 0);
            d3.select("#rect0")
                .transition()
                .duration(500)
                .style("opacity", 0.75);
        });

        svg.select("#overallGoalsText2")
        .on("mouseover", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .style("opacity", 1);
            d3.select("#goalsConcededPercentage")
                .transition()
                .duration(500)
                .style("opacity", 1);
            d3.select("#rect1")
                .transition()
                .duration(500)
                .style("opacity", 1);
        })
        .on("mouseout", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .style("opacity", 0);
            d3.select("#goalsConcededPercentage")
                .transition()
                .duration(500)
                .style("opacity", 0);
            d3.select("#rect1")
                .transition()
                .duration(500)
                .style("opacity", 0.75);
        });
</script>

</html>