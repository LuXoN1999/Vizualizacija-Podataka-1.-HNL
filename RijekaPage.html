<!DOCTYPE html>
<html>

<head>
    <title>NK Rijeka</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="./teams.js"></script>
    <script src="./mainVariables.js"></script>
    <script src="./additionalFunctions.js"></script>
    <style>
        body {
            background-color: white;
        }
    </style>

</head>

<body>

</body>
<script>
    var currentTeamIndex = 3;

    var svg = d3.select("body")
        .append("svg")
        .attr("width", svgWidth)
        .attr("height", svgHeight)
        .style("border-radius", defaultBorderRadius)
        .style("background-color", "#808080")
        .style("opacity", 0.75);

    var clubImage = svg.append("image")
        .attr("x", clubEmblemX)
        .attr("y", clubEmblemY)
        .attr("width", clubEmblemWidth)
        .attr("height", clubEmblemHeight)
        .attr("xlink:href", "./Images/NKRijeka.png");

    var clubNameText = svg.append("text")
        .text(teamsData[currentTeamIndex].name)
        .attr("x", clubHeaderTextX)
        .attr("y", clubHeaderTextY)
        .style("font-size", headerTextFontSize)
        .style("font-family", defaultFontFamily);

    var WDLText = svg.append("text")
        .text("Pobjede/Neriješeno/Porazi")
        .attr("x", WDLTextX)
        .attr("y", commonTextY)
        .style("font-size", normalTextFontSize)
        .style("font-family", defaultFontFamily);

    var playersText = svg.append("text")
        .text("Igrači: " + (teamsData[currentTeamIndex].totalplayers).toString())
        .attr("x", playersTextX)
        .attr("y", commonTextY)
        .style("font-size", normalTextFontSize)
        .style("font-family", defaultFontFamily);

    var nationalTeamPlayersText = svg.append("text")
        .text("Reprezentativci: " + teamsData[currentTeamIndex].nationalteamplayers)
        .attr("x", playersTextX - 175)
        .attr("y", commonTextY + 50)
        .style("font-size", smallTextFontSize)
        .style("font-family", defaultFontFamily);

    var foreignPlayersText = svg.append("text")
        .text("Stranci: " + teamsData[currentTeamIndex].foreignplayers)
        .attr("x", playersTextX - 175)
        .attr("y", commonTextY + 275)
        .style("font-size", smallTextFontSize)
        .style("font-family", defaultFontFamily);

    var nationalTeamPlayersPie = d3.pie()
        .value(function (d, i) {
            if (i == 0) {
                return teamsData[currentTeamIndex].nationalteamplayers;
            }
            else if (i == 1) {
                return teamsData[currentTeamIndex].totalplayers - teamsData[currentTeamIndex].nationalteamplayers;
            }
            else {
                return 0;
            }
        });

    var nationalTeamPlayersPieArcs = svg.selectAll("g.pie")
        .data(nationalTeamPlayersPie(teamsData))
        .enter()
        .append("path")
        .attr("id", function (d, i) { return "pie0_arc" + i })
        .attr("transform", "translate(" + commonPieChartX + ", " + upperPieChartY + ")")
        .attr("d", defaultArc)
        .attr("fill", function (d, i) {
            if (i == 0) {
                return color[1];
            }
            return color[0];
        });

    var nationalTeamPlayersPercentageText = svg.append("text")
        .text(parseFloat((teamsData[currentTeamIndex].nationalteamplayers / teamsData[currentTeamIndex].totalplayers * 100)).toFixed(1) + "%")
        .attr("x", commonPieChartX + 10)
        .attr("y", upperPieChartY)
        .attr("id", "nationalTeamPercentageText")
        .style("opacity", 0)
        .style("fill", "red")
        .style("font-size", normalTextFontSize)
        .style("font-family", defaultFontFamily);

    var foreignPlayersPie = d3.pie()
        .value(function (d, i) {
            if (i == 0) {
                return teamsData[currentTeamIndex].foreignplayers;
            }
            else if (i == 1) {
                return teamsData[currentTeamIndex].totalplayers - teamsData[currentTeamIndex].foreignplayers;
            }
            else {
                return 0;
            }
        });

    var foreignPlayersPieArcs = svg.selectAll("g.pie")
        .data(foreignPlayersPie(teamsData))
        .enter()
        .append("path")
        .attr("id", function (d, i) { return "pie1_arc" + i })
        .attr("transform", "translate(" + commonPieChartX + "," + lowerPieChartY + ")")
        .attr("d", defaultArc)
        .attr("fill", function (d, i) {
            if (i == 0) {
                return color[1];
            }
            return color[0];
        });

    var foreignPlayersPercentageText = svg.append("text")
        .text(parseFloat((teamsData[currentTeamIndex].foreignplayers / teamsData[currentTeamIndex].totalplayers * 100)).toFixed(1) + "%")
        .attr("x", commonPieChartX + 10)
        .attr("y", lowerPieChartY)
        .attr("id", "foreignPlayersPercentageText")
        .style("opacity", 0)
        .style("fill", "red")
        .style("font-size", normalTextFontSize)
        .style("font-family", defaultFontFamily);

    svg.select("#pie0_arc0")
        .on("mouseover", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .attr("d", arcOnHover)
                .style("fill", "red")
                .style("opacity", 0.5);
            d3.select("#nationalTeamPercentageText")
                .transition()
                .duration(500)
                .style("opacity", 1);
        })
        .on("mouseout", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .attr("d", defaultArc)
                .style("fill", color[1])
                .style("opacity", 1);
            d3.select("#nationalTeamPercentageText")
                .transition()
                .duration(500)
                .style("opacity", 0);
        });

    svg.select("#pie1_arc0")
        .on("mouseover", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .attr("d", arcOnHover)
                .style("fill", "red")
                .style("opacity", 0.5);
            d3.select("#foreignPlayersPercentageText")
                .transition()
                .duration(500)
                .style("opacity", 1);
        })
        .on("mouseout", function () {
            d3.select(this)
                .transition()
                .duration(500)
                .attr("d", defaultArc)
                .style("fill", color[1])
                .style("opacity", 1);
            d3.select("#foreignPlayersPercentageText")
                .transition()
                .duration(500)
                .style("opacity", 0);
        });

    clearUnnecessaryArcs();
</script>


</html>